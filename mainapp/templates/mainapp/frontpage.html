{% extends "mainapp/base.html" %}
{% load static %}
<style type="text/css">
    .carousel {
        width:640px;
        height:360px;
    }
    h4:hover {
        cursor: pointer;
    }
    .MultiCarousel {
        float: left;
        overflow: hidden;
        padding: 15px;
        width: 100%;
        position: relative;
    }
    
    .MultiCarousel .MultiCarousel-inner {
        transition: 1s ease all;
        float: left;
    }
    
    .MultiCarousel .MultiCarousel-inner .item {
        float: left;
    }
    
    .MultiCarousel .MultiCarousel-inner .item > div {
        text-align: center;
        padding: 10px;
        margin: 10px;
        background: #f1f1f1;
        color: #666;
    }
    
    .MultiCarousel .leftLst,
    .MultiCarousel .rightLst {
        position: absolute;
        border-radius: 50%;
        top: calc(50% - 20px);
    }
    
    .MultiCarousel .leftLst {
        left: 0;
    }
    
    .MultiCarousel .rightLst {
        right: 0;
    }
    
    .MultiCarousel .leftLst.over,
    .MultiCarousel .rightLst.over {
        pointer-events: none;
        background: #ccc;
    }
</style>
{% block content %}
<!-- Start of Image Carousel & Search -->
<div class="container">

	<form class="col-xl-12" id="searchForm">
        {% csrf_token %}
		<div class="input-group col-md-12">
			<input style="  font-size: 15px !important;" type="text" name="booksearch" class="form-control input-lg" placeholder="Search for book"/>
			<span class="input-group-btn">
				<button style="background-color: white; border-style:none; border-left: solid 1px #ccc;" class="btn btn-info btn-lg" type="submit" onclick="makeSearch();return false;">
					<i style="color:black;" class="glyphicon glyphicon-search"></i>
				</button>
			</span>
		</div>
	</form>
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
            <li data-target="#myCarousel" data-slide-to="2"></li>
            <li data-target="#myCarousel" data-slide-to="3"></li>
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner">
            <div class="item active">
                <img src="{% static 'assets/library1.jpg' %}" alt="Library Image">
            </div>

            <div class="item">
                <img src="{% static 'assets/library2.jpg' %}" alt="Library Image">
            </div>

            <div class="item">
                <img src="{% static 'assets/library3.jpg' %}" alt="Library Image">
            </div>

            <div class="item">
                <img src="{% static 'assets/library4.jpg' %}" alt="Library Image">
            </div>
		</div>

        <!-- Left and right controls -->
        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>
</div>
<div class="container">
    <div>
        <ul class="list-group list-group-flush" id="searchresult"></ul>
    </div>
</div>
<!-- End of Image Carousel & Search -->
<hr>
<!-- Recently added books carousel -->
<div class="container">
    <!-- <h1>Recently Added Books!</h1> -->
    <div class="row">
        <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recently Added Books...</p>
        <div class="slick_carousel MultiCarousel">
            {% for books in recently_added_books %}
                <div class="mt-2 col-md-12">
                    <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')">
                        <p class="lead img-responsive">
                            <img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;">
                        </p>
                        <p align="center">{{books.title}}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- <div class="row">
        <div class="MultiCarousel" data-items="1,3,5,6" data-slide="1" id="MultiCarousel" data-interval="1000">
            <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recently Added Books...</p>
            <div class="MultiCarousel-inner" id="carousel_items_1">
                {% for books in recently_added_books %}
                <div class="item">
                    <div class="pad15">
                        <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="btn btn-primary leftLst">
                <</button>
                <button class="btn btn-primary rightLst">
                ></button>
        </div>
    </div> -->
    <!--  <a href="https://github.com/rtpHarry/Bootstrap3-ShowManySlideOneCarousel">this code sample</a>   -->
    <!-- <div class="row">
        <div class="col-md-12">
            <div class="carousel carousel-showmanymoveone slide" id="carousel-tilenav_1" data-interval="false">
                <div class="carousel-inner">
                    {% for books in recently_added_books %}
                        <div class="item">
                            <div class="col-xs-12 col-sm-6 col-md-2">comment this line
                            <div class="col-xs-2">
                                <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                            </div>
                        </div>
                    {% endfor %}
                    <div class="item active">
                        <div class="col-xs-12 col-sm-6 col-md-2"> comment this line
                            <a href="#"><img src="http://placehold.it/500/0054A6/fff/&amp;text=1" class="img-responsive"></a>comment this line
                        </div>comment this line
                    </div>
                </div>
                <a class="left carousel-control" href="#carousel-tilenav_1" data-slide="prev"><i class="glyphicon glyphicon-chevron-left"></i></a>
                <a class="right carousel-control" href="#carousel-tilenav_1" data-slide="next"><i class="glyphicon glyphicon-chevron-right"></i></a>
            </div>
        </div>
    </div> -->
</div>
<!-- average_rating_recommendation books carousel -->
<div class="container">
    <div class="row">
        <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Books Based on Ratings...</p>
        <div class="slick_carousel MultiCarousel">
            {% for books in average_rating_recommendation %}
                <div class="mt-2 col-md-12">
                    <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')">
                        <p class="lead img-responsive">
                            <img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;">
                        </p>
                        <p align="center">{{books.title}}</p>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- <div class="row">
        <div class="MultiCarousel" data-items="1,3,5,6" data-slide="1" id="MultiCarousel" data-interval="1000">
            <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Books Based on Ratings...</p>
            <div class="MultiCarousel-inner" id="carousel_items_1">
                {% for books in average_rating_recommendation %}
                <div class="item">
                    <div class="pad15">
                        <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="btn btn-primary leftLst">
                <</button>
                <button class="btn btn-primary rightLst">
                ></button>
        </div>
    </div> -->

    <!--  <a href="https://github.com/rtpHarry/Bootstrap3-ShowManySlideOneCarousel">this code sample</a>   -->
    <!-- <div class="row">
        <div class="col-md-12">
            <div class="carousel carousel-showmanymoveone slide" id="carousel-tilenav_2" data-interval="false">
                <div class="carousel-inner">
                    {% for books in average_rating_recommendation %}
                        <div class="item">
                            <div class="col-xs-12 col-sm-6 col-md-2"> comment this line
                            <div class="col-xs-2">
                                <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                            </div>
                        </div>
                    {% endfor %}
                    <div class="item active">
                        <div class="col-xs-12 col-sm-6 col-md-2">comment this line
                            <a href="#"><img src="http://placehold.it/500/0054A6/fff/&amp;text=1" class="img-responsive"></a>comment this line
                        </div>comment this line
                    </div>
                </div>
                <a class="left carousel-control" href="#carousel-tilenav_2" data-slide="prev"><i class="glyphicon glyphicon-chevron-left"></i></a>
                <a class="right carousel-control" href="#carousel-tilenav_2" data-slide="next"><i class="glyphicon glyphicon-chevron-right"></i></a>
            </div>
        </div>
    </div> -->
</div>
<!-- other_user_favourite_books books carousel -->
{% if user.is_authenticated %}
    {% if other_user_favourite_books %}
        <div class="container">
            <div class="row">
                <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Favourite books from similar users'...</p>
                <div class="slick_carousel MultiCarousel">
                    {% for books in other_user_favourite_books %}
                        <div class="mt-2 col-md-12">
                            <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')">
                                <p class="lead img-responsive">
                                    <img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;">
                                </p>
                                <p align="center">{{books.title}}</p>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <!-- <div class="row">
                <div class="MultiCarousel" data-items="1,3,5,6" data-slide="1" id="MultiCarousel" data-interval="1000">
                    <p style="font-weight:bold; color: grey; font-size: 20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Favourite books from similar users'...</p>
                    <div class="MultiCarousel-inner" id="carousel_items_1">
                        {% for books in other_user_favourite_books %}
                        <div class="item">
                            <div class="pad15">
                                <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button class="btn btn-primary leftLst">
                        <</button>
                        <button class="btn btn-primary rightLst">></button>
                </div>
            </div> -->

            <!--  <a href="https://github.com/rtpHarry/Bootstrap3-ShowManySlideOneCarousel">this code sample</a>   -->
            <!-- <div class="row">
                <div class="col-md-12">
                    <div class="carousel carousel-showmanymoveone slide" id="carousel-tilenav_3" data-interval="false">
                        <div class="carousel-inner">
                            {% for books in other_user_favourite_books %}
                                <div class="item">
                                     <div class="col-xs-12 col-sm-6 col-md-2"> comment this line
                                    <div class="col-xs-2">
                                        <a style="cursor: pointer;" onclick="goToBookPage('{{books.isbn_13}}')"><p class="lead img-responsive"><img src={{books.thumbnail}} alt="No Image" style="width:100%; display: inline-block; height: 200px;"></p><p>{{books.title}}</p></a>
                                    </div>
                                </div>
                            {% endfor %}
                            <div class="item active">
                                 <div class="col-xs-12 col-sm-6 col-md-2">comment this line
                                    <a href="#"><img src="http://placehold.it/500/0054A6/fff/&amp;text=1" class="img-responsive"></a>comment this line
                                </div> comment this line
                            </div>
                        </div>
                        <a class="left carousel-control" href="#carousel-tilenav_3" data-slide="prev"><i class="glyphicon glyphicon-chevron-left"></i></a>
                        <a class="right carousel-control" href="#carousel-tilenav_3" data-slide="next"><i class="glyphicon glyphicon-chevron-right"></i></a>
                    </div>
                </div>
            </div> -->
        </div>
    {% endif %}
{% endif %}
<script type="text/javascript">
    $(document).ready(function(){
        $('.slick_carousel').slick({
            accessibility:true,
            arrows:true,
            prevArrow:'<button class="btn btn-primary leftLst"><</button>',
            nextArrow:'<button class="btn btn-primary rightLst">></button>',
            dots:false,
            draggable:false,
            mobileFirst:false,
            slidesPerRow: 6,
            slidesToShow: 6,
            infinite:true,
            touchMove:true,
        });
    });
    $('.slick_carousel').on('wheel', (function(e){
        e.preventDefault();
        if (e.originalEvent.deltaY < 0){
            $(this).slick('slickNext');
        } else {
            $(this).slick('slickPrev');
        }
    }));

    // for carousel
    // $(document).ready(function() {
    //     var itemsMainDiv = ('.MultiCarousel');
    //     var itemsDiv = ('.MultiCarousel-inner');
    //     var itemWidth = "";

    //     $('.leftLst, .rightLst').click(function() {
    //         var condition = $(this).hasClass("leftLst");
    //         if (condition)
    //             click(0, this);
    //         else
    //             click(1, this)
    //     });

    //     ResCarouselSize();

    //     $(window).resize(function() {
    //         ResCarouselSize();
    //     });

    //     //this function define the size of the items
    //     function ResCarouselSize() {
    //         var incno = 0;
    //         var dataItems = ("data-items");
    //         var itemClass = ('.item');
    //         var id = 0;
    //         var btnParentSb = '';
    //         var itemsSplit = '';
    //         var sampwidth = $(itemsMainDiv).width();
    //         var bodyWidth = $('body').width();
    //         $(itemsDiv).each(function() {
    //             id = id + 1;
    //             var itemNumbers = $(this).find(itemClass).length;
    //             btnParentSb = $(this).parent().attr(dataItems);
    //             itemsSplit = btnParentSb.split(',');
    //             $(this).parent().attr("id", "MultiCarousel" + id);

    //             if (bodyWidth >= 1200) {
    //                 incno = itemsSplit[3];
    //                 itemWidth = sampwidth / incno;
    //             } else if (bodyWidth >= 992) {
    //                 incno = itemsSplit[2];
    //                 itemWidth = sampwidth / incno;
    //             } else if (bodyWidth >= 768) {
    //                 incno = itemsSplit[1];
    //                 itemWidth = sampwidth / incno;
    //             } else {
    //                 incno = itemsSplit[0];
    //                 itemWidth = sampwidth / incno;
    //             }
    //             $(this).css({
    //                 'transform': 'translateX(0px)',
    //                 'width': itemWidth * itemNumbers
    //             });
    //             $(this).find(itemClass).each(function() {
    //                 $(this).outerWidth(itemWidth);
    //             });

    //             $(".leftLst").addClass("over");
    //             $(".rightLst").removeClass("over");

    //         });
    //     }

    //     //this function used to move the items
    //     function ResCarousel(e, el, s) {
    //         var leftBtn = ('.leftLst');
    //         var rightBtn = ('.rightLst');
    //         var translateXval = '';
    //         var divStyle = $(el + ' ' + itemsDiv).css('transform');
    //         var values = divStyle.match(/-?[\d\.]+/g);
    //         var xds = Math.abs(values[4]);
    //         if (e == 0) {
    //             translateXval = parseInt(xds) - parseInt(itemWidth * s);
    //             $(el + ' ' + rightBtn).removeClass("over");

    //             if (translateXval <= itemWidth / 2) {
    //                 translateXval = 0;
    //                 $(el + ' ' + leftBtn).addClass("over");
    //             }
    //         } else if (e == 1) {
    //             var itemsCondition = $(el).find(itemsDiv).width() - $(el).width();
    //             translateXval = parseInt(xds) + parseInt(itemWidth * s);
    //             $(el + ' ' + leftBtn).removeClass("over");

    //             if (translateXval >= itemsCondition - itemWidth / 2) {
    //                 translateXval = itemsCondition;
    //                 $(el + ' ' + rightBtn).addClass("over");
    //             }
    //         }
    //         $(el + ' ' + itemsDiv).css('transform', 'translateX(' + -translateXval + 'px)');
    //     }

    //     //It is used to get some elements from btn
    //     function click(ell, ee) {
    //         var Parent = "#" + $(ee).parent().attr("id");
    //         var slide = $(Parent).attr("data-slide");
    //         ResCarousel(ell, Parent, slide);
    //     }

    // });

    // End of carousel

    // Old carousel code
    // (function() {
    //     $('.carousel-showmanymoveone .item').each(function() {
    //         var itemToClone = $(this);

    //         for (var i = 1; i < 6; i++) {
    //             itemToClone = itemToClone.next();

    //             // wrap around if at end of item collection
    //             if (!itemToClone.length) {
    //                 itemToClone = $(this).siblings(':first');
    //             }

    //             // grab item, clone, add marker class, add to collection
    //             itemToClone.children(':first-child').clone()
    //             .addClass("cloneditem-" + (i))
    //             .appendTo($(this));
    //         }
    //     });
    // }());
    // End of Old carousel code
    
    // if (window.performance && window.performance.navigation.type == window.performance.navigation.TYPE_BACK_FORWARD) {
        //only display when user goes form book page to front page of some backpage to frontpage.html
    //     "{% if recent_search %}"
    //         var elem = document.querySelector('#myCarousel');
    //         if(elem) {
    //             elem.parentNode.removeChild(elem);
    //         }
    //         "{% for results in recent_search %}"
    //             var uid = "{{results.id}}";
    //             var thumbnail = "{{results.thumbnail}}";
    //             var isbn_13 = "{{results.isbn_13}}";
    //             var isbn_10 = "{{results.isbn_10}}";
    //             var volumeinfo = "{{results.title}}";
    //             var authors = "{{results.authors}}";
    //             var ratingsCount = "{{results.ratingsCount}}";
    //             var averageRating = "{{results.averageRating}}";

    //             var checkElement = document.getElementById(uid);
    //             if (!checkElement) {
    //                 $("#searchresult").append('<div class="row" id=' + uid + '><br><div class="col-sm-2"><img alt="" src=' + thumbnail + ' style="height: 150px; width: 150px" /></div><div class="col-sm-8"><h4><a style="cursor: pointer;" onclick="goToBookPage('+isbn_13+','+isbn_10+')">' + volumeinfo + '</a></h4><p> Authors:' + authors + '</p><p>' + ratingsCount + ' ratings, '+averageRating+' average rating</p></div></div>');
    //             }
    //         "{% endfor %}"
    //     "{% endif %}"
    // }

    "{% if recent_search %}"
        var elem = document.querySelector('#myCarousel');
        if(elem) {
            elem.parentNode.removeChild(elem);
        }
        "{% for results in recent_search %}"
            var uid = "{{results.id}}";
            var thumbnail = "{{results.thumbnail}}";
            var isbn_13 = "{{results.isbn_13}}";
            var isbn_10 = "{{results.isbn_10}}";
            var volumeinfo = "{{results.title}}";
            var authors = "{{results.authors}}";
            var ratingsCount = "{{results.ratingsCount}}";
            var averageRating = "{{results.averageRating}}";

            var checkElement = document.getElementById(uid);
            if (!checkElement) {
                $("#searchresult").append('<div class="row" id=' + uid + '><br><div class="col-sm-2"><img alt="" src=' + thumbnail + ' style="height: 150px; width: 150px" /></div><div class="col-sm-8"><h4><a style="cursor: pointer;" onclick="goToBookPage('+isbn_13+')">' + volumeinfo + '</a></h4><p> Authors:' + authors + '</p><p>' + ratingsCount + ' ratings, '+averageRating+' average rating</p></div></div>');
            }
        "{% endfor %}"
    "{% endif %}"

    function searchByISBN(isbn) {

        var result = []
        var makerequest = "https://www.googleapis.com/books/v1/volumes?q=isbn:"+isbn;

        $.get(makerequest, function(response) {
            for (var i = 0; i<response.items.length; i++) {
                result.push();
            }
        });
    }

    function makeSearch() {
        var list = document.getElementById("searchresult");
        while (list.hasChildNodes()) {
            list.removeChild(list.firstChild);
        }
        var booksearch = document.getElementsByName("booksearch")[0].value;
        var makerequest = "https://www.googleapis.com/books/v1/volumes?q="+booksearch;//+":keyes&key=AIzaSyALnLIg8cf5Z6SdBIX5HzP5i-qKYmwyUiA";

        var all_books = [];

        $.get(makerequest, function(response) {
            console.log(response.items);
            var elem = document.querySelector('#myCarousel');
            if(elem) {
                elem.parentNode.removeChild(elem);
            }
            try {
                for (var i = 0; i<response.items.length; i++) {
                    try {
                        //Required Attributes
                        var uid = response.items[i].id;
                        var etag = response.items[i].etag;
                        var volumeinfo = response.items[i].volumeInfo.title;
                        var authors = response.items[i].volumeInfo.authors;
                        var averageRating = response.items[i].volumeInfo.averageRating;
                        var ratingsCount = response.items[i].volumeInfo.ratingsCount;
                        var thumbnail = response.items[i].volumeInfo.imageLinks.thumbnail;
                        var categories = response.items[i].volumeInfo.categories;
                        var isbn_13 = null;
                        var isbn_10 = null;

                        if (response.items[i].volumeInfo.industryIdentifiers[0].type == "ISBN_10") {
                            isbn_10 = response.items[i].volumeInfo.industryIdentifiers[0].identifier;
                        } else if (response.items[i].volumeInfo.industryIdentifiers[0].type == "ISBN_13") {
                            isbn_13 = response.items[i].volumeInfo.industryIdentifiers[0].identifier;
                        }

                        if (response.items[i].volumeInfo.industryIdentifiers[1].type == "ISBN_10") {
                            isbn_10 = response.items[i].volumeInfo.industryIdentifiers[1].identifier;
                        } else if(response.items[i].volumeInfo.industryIdentifiers[1].type == "ISBN_13") {
                            isbn_13 = response.items[i].volumeInfo.industryIdentifiers[1].identifier;
                        }
                        var description = response.items[i].volumeInfo.description;
                        console.log(isbn_13,authors);
                        
                        var industryIdentifiers = response.items[i].volumeInfo.industryIdentifiers;
                        if(industryIdentifiers.length==2) {
                            if(!ratingsCount) {
                                ratingsCount = 0;
                            }
                            if(!averageRating) {
                                averageRating = 0.0
                            }

                            averageRating = averageRating.toFixed(1)

                            var checkElement = document.getElementById(uid);

                            if (!checkElement) {
                                $("#searchresult").append('<div class="row" id=' + uid + '><br><div class="col-sm-2"><img alt="" src=' + thumbnail + ' style="height: 150px; width: 150px" /></div><div class="col-sm-8"><h4><a style="cursor: pointer;" onclick="goToBookPage('+isbn_13+')">' + volumeinfo + '</a></h4><p> Authors:' + authors + '</p><p>' + ratingsCount + ' ratings, '+averageRating+' average rating</p></div></div>');
                            }
                            all_books.push(response.items[i]);
                        }
                    }
                    catch(err){
                        console.log("No result found");
                    }
                }
            } catch {
                $("#searchresult").append('<p style="left: 0; line-height: 200px; margin-top: -100px; position: absolute; text-align: center; top: 50%; width: 100%; font-weight: 900;">Sorry, we could\'t find any results matching "'+booksearch+'"</p><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>');
            }

            //Send to server to create a model for the book and add to csv
            $.ajax({
                type: "POST",
                data: {
                    book: JSON.stringify(all_books)
                },
                success: function() {
                    console.log("DONE");
                }
            })

        });
    }

    var goToBookPage = function(isbn_13) {
        console.log(isbn_13, "Inside goToBookPage function");
        window.location.href = "book_page/"+isbn_13+"/";
    }

    //Brower Type
    function user_Browser_Version() {
        var navUserAgent = navigator.userAgent;
        var browserName = navigator.appName;
        var browserVersion = '' + parseFloat(navigator.appVersion);
        var majorVersion = parseInt(navigator.appVersion, 10);
        var tempNameOffset, tempVersionOffset, tempVersion;

        if ((tempVersionOffset = navUserAgent.indexOf("Opera")) != -1) {
            browserName = "Opera";
            browserVersion = navUserAgent.substring(tempVersionOffset + 6);
            if ((tempVersionOffset = navUserAgent.indexOf("Version")) != -1)
                browserVersion = navUserAgent.substring(tempVersionOffset + 8);
        } else if ((tempVersionOffset = navUserAgent.indexOf("MSIE")) != -1) {
            browserName = "Microsoft Internet Explorer";
            browserVersion = navUserAgent.substring(tempVersionOffset + 5);
        } else if ((tempVersionOffset = navUserAgent.indexOf("Chrome")) != -1) {
            browserName = "Chrome";
            browserVersion = navUserAgent.substring(tempVersionOffset + 7);
        } else if ((tempVersionOffset = navUserAgent.indexOf("Safari")) != -1) {
            browserName = "Safari";
            browserVersion = navUserAgent.substring(tempVersionOffset + 7);
            if ((tempVersionOffset = navUserAgent.indexOf("Version")) != -1)
                browserVersion = navUserAgent.substring(tempVersionOffset + 8);
        } else if ((tempVersionOffset = navUserAgent.indexOf("Firefox")) != -1) {
            browserName = "Firefox";
            browserVersion = navUserAgent.substring(tempVersionOffset + 8);
        } else if ((tempNameOffset = navUserAgent.lastIndexOf(' ') + 1) < (tempVersionOffset = navUserAgent.lastIndexOf('/'))) {
            browserName = navUserAgent.substring(tempNameOffset, tempVersionOffset);
            browserVersion = navUserAgent.substring(tempVersionOffset + 1);
            if (browserName.toLowerCase() == browserName.toUpperCase()) {
                browserName = navigator.appName;
            }
        }

        // trim version
        if ((tempVersion = browserVersion.indexOf(";")) != -1)
            browserVersion = browserVersion.substring(0, tempVersion);
        if ((tempVersion = browserVersion.indexOf(" ")) != -1)
            browserVersion = browserVersion.substring(0, tempVersion);

        //alert("BrowserName = " + browserName + "\n" + "Version = " + browserVersion);
        return browserName;
    }

    function ipLookUp() {
        var user_country = "Unknown";
        $.ajax('http://ip-api.com/json')
            .then(
                function success(response) {
                   user_country = response.country;
                   user_browser = user_Browser_Version();
                   $.ajax({
                        type: "POST",
                        url: "add_user_country_browser/",
                        data: {
                            user_country: user_country,
                            user_browser: user_browser,
                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                        },
                        success: function(response)
                        {
                        }
                   });
                },
                function fail(data, status) {
                    user_country =  "Unknowns";
                    user_browser = user_Browser_Version();
                    $.ajax({
                        type: "POST",
                        url: "add_user_country_browser/",
                        data: {
                            user_country: user_country,
                            user_browser: user_browser,
                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                        },
                        success: function(response)
                        {
                        }
                   });
                }
            );
        return user_country;
    }
    ipLookUp();
</script>
{% endblock %}